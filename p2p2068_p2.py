import os.path as osp
from math import ceil

import torch
import torch.nn.functional as F

import torch_geometric.transforms as T
from MyData_fromTU import MyData_fromTU
from torch_geometric.loader import DenseDataLoader
from torch_geometric.nn import DenseSAGEConv, dense_diff_pool
import numpy as np
#第二级训练

max_nodes = 206
class MyFilter(object):
    def __call__(self, data):
        return data.num_nodes <= max_nodes
bmname = 'p2p2068'
sname = '_p0.1_ob0.5_m10'
path = osp.join(osp.dirname(osp.realpath(__file__)), 'data',
                bmname)
dataset = MyData_fromTU(path, name=bmname+ sname, transform=T.ToDense(max_nodes),
                    pre_filter=MyFilter())
dataset = dataset.shuffle()
n = (len(dataset) + 9) // 10
test_dataset = dataset[:n]
val_dataset = dataset[n:2 * n]
train_dataset = dataset[2 * n:]
test_loader = DenseDataLoader(test_dataset, batch_size=20, shuffle=True)
val_loader = DenseDataLoader(val_dataset, batch_size=20, shuffle=True)
train_loader = DenseDataLoader(train_dataset, batch_size=20, shuffle=True)

# class0= {10: 0, 18: 1, 24: 2, 26: 3, 36: 4, 41: 5, 46: 6, 59: 7, 61: 8, 63: 9, 88: 10, 97: 11, 115: 12, 120: 13, 121: 14, 129: 15, 130: 16, 131: 17, 153: 18, 157: 19, 162: 20, 164: 21, 178: 22, 183: 23, 187: 24, 195: 25, 210: 26, 211: 27, 212: 28, 214: 29, 220: 30, 225: 31, 236: 32, 258: 33, 266: 34, 271: 35, 281: 36, 284: 37, 293: 38, 303: 39, 304: 40, 325: 41, 327: 42, 332: 43, 334: 44, 336: 45, 359: 46, 366: 47, 370: 48, 380: 49, 384: 50, 393: 51, 394: 52, 399: 53, 413: 54, 428: 55, 430: 56, 432: 57, 450: 58, 454: 59, 457: 60, 474: 61, 492: 62, 499: 63, 518: 64, 533: 65, 546: 66, 558: 67, 565: 68, 570: 69, 572: 70, 576: 71, 579: 72, 583: 73, 614: 74, 616: 75, 619: 76, 635: 77, 636: 78, 639: 79, 643: 80, 650: 81, 651: 82, 657: 83, 658: 84, 659: 85, 665: 86, 667: 87, 672: 88, 673: 89, 682: 90, 710: 91, 716: 92, 719: 93, 728: 94, 739: 95, 740: 96, 744: 97, 758: 98, 762: 99, 764: 100, 773: 101, 785: 102, 787: 103, 788: 104, 795: 105, 797: 106, 812: 107, 826: 108, 831: 109, 835: 110, 836: 111, 850: 112, 852: 113, 854: 114, 860: 115, 872: 116, 879: 117, 882: 118, 890: 119, 902: 120, 903: 121, 904: 122, 906: 123, 923: 124, 947: 125, 954: 126, 958: 127, 971: 128, 981: 129, 982: 130, 989: 131, 1014: 132, 1016: 133, 1022: 134, 1036: 135, 1040: 136, 1042: 137, 1051: 138, 1057: 139, 1064: 140, 1068: 141, 1072: 142, 1083: 143, 1085: 144, 1094: 145, 1096: 146, 1108: 147, 1111: 148, 1120: 149, 1141: 150, 1144: 151, 1162: 152, 1173: 153, 1186: 154, 1189: 155, 1190: 156, 1210: 157, 1217: 158, 1234: 159, 1236: 160, 1240: 161, 1258: 162, 1269: 163, 1284: 164, 1285: 165, 1288: 166, 1292: 167, 1298: 168, 1304: 169, 1317: 170, 1325: 171, 1333: 172, 1336: 173, 1340: 174, 1343: 175, 1353: 176, 1355: 177, 1358: 178, 1369: 179, 1400: 180, 1402: 181, 1405: 182, 1418: 183, 1420: 184, 1422: 185, 1427: 186, 1430: 187, 1431: 188, 1453: 189, 1458: 190, 1459: 191, 1461: 192, 1464: 193, 1481: 194, 1482: 195, 1486: 196, 1499: 197, 1501: 198, 1512: 199, 1521: 200, 1522: 201, 1525: 202, 1532: 203, 1541: 204, 1546: 205, 1581: 206, 1583: 207, 1592: 208, 1607: 209, 1613: 210, 1616: 211, 1629: 212, 1631: 213, 1649: 214, 1652: 215, 1653: 216, 1659: 217, 1667: 218, 1668: 219, 1681: 220, 1705: 221, 1706: 222, 1710: 223, 1715: 224, 1718: 225, 1736: 226, 1743: 227, 1754: 228, 1765: 229, 1766: 230, 1781: 231, 1786: 232, 1808: 233, 1812: 234, 1816: 235, 1818: 236, 1819: 237, 1825: 238, 1832: 239, 1833: 240, 1847: 241, 1852: 242, 1861: 243, 1865: 244, 1866: 245, 1872: 246, 1882: 247, 1892: 248, 1913: 249, 1917: 250, 1920: 251, 1923: 252, 1927: 253, 1928: 254, 1929: 255, 1945: 256, 1959: 257, 1979: 258, 1980: 259, 2007: 260, 2008: 261, 2011: 262, 2041: 263, 2046: 264, 2047: 265, 2058: 266, 2062: 267, 2067: 268}
# class1= {1: 0, 2: 1, 6: 2, 7: 3, 8: 4, 15: 5, 17: 6, 21: 7, 25: 8, 29: 9, 33: 10, 34: 11, 35: 12, 38: 13, 43: 14, 45: 15, 47: 16, 50: 17, 51: 18, 54: 19, 55: 20, 58: 21, 65: 22, 66: 23, 71: 24, 74: 25, 79: 26, 83: 27, 91: 28, 94: 29, 99: 30, 100: 31, 102: 32, 104: 33, 106: 34, 108: 35, 110: 36, 112: 37, 113: 38, 114: 39, 116: 40, 126: 41, 128: 42, 132: 43, 136: 44, 137: 45, 145: 46, 149: 47, 155: 48, 156: 49, 159: 50, 163: 51, 168: 52, 169: 53, 172: 54, 175: 55, 186: 56, 190: 57, 197: 58, 198: 59, 204: 60, 206: 61, 208: 62, 213: 63, 215: 64, 219: 65, 222: 66, 229: 67, 233: 68, 235: 69, 237: 70, 238: 71, 239: 72, 241: 73, 247: 74, 262: 75, 263: 76, 273: 77, 276: 78, 278: 79, 291: 80, 292: 81, 295: 82, 298: 83, 309: 84, 312: 85, 315: 86, 321: 87, 322: 88, 326: 89, 335: 90, 342: 91, 345: 92, 346: 93, 349: 94, 363: 95, 369: 96, 372: 97, 374: 98, 375: 99, 377: 100, 381: 101, 382: 102, 387: 103, 392: 104, 397: 105, 403: 106, 408: 107, 409: 108, 410: 109, 414: 110, 427: 111, 433: 112, 435: 113, 436: 114, 441: 115, 444: 116, 445: 117, 447: 118, 448: 119, 465: 120, 466: 121, 467: 122, 471: 123, 485: 124, 487: 125, 488: 126, 490: 127, 493: 128, 496: 129, 500: 130, 505: 131, 511: 132, 513: 133, 516: 134, 519: 135, 526: 136, 527: 137, 531: 138, 536: 139, 547: 140, 553: 141, 554: 142, 555: 143, 556: 144, 563: 145, 568: 146, 574: 147, 586: 148, 590: 149, 591: 150, 592: 151, 594: 152, 597: 153, 608: 154, 610: 155, 612: 156, 613: 157, 623: 158, 628: 159, 631: 160, 652: 161, 654: 162, 662: 163, 664: 164, 669: 165, 671: 166, 674: 167, 676: 168, 678: 169, 679: 170, 680: 171, 685: 172, 689: 173, 690: 174, 691: 175, 694: 176, 698: 177, 699: 178, 701: 179, 705: 180, 706: 181, 708: 182, 712: 183, 718: 184, 720: 185, 721: 186, 722: 187, 727: 188, 729: 189, 736: 190, 745: 191, 746: 192, 747: 193, 750: 194, 752: 195, 753: 196, 760: 197, 761: 198, 766: 199, 769: 200, 770: 201, 772: 202, 775: 203, 777: 204, 779: 205, 780: 206, 786: 207, 791: 208, 800: 209, 804: 210, 806: 211, 807: 212, 814: 213, 819: 214, 820: 215, 822: 216, 824: 217, 825: 218, 837: 219, 839: 220, 841: 221, 844: 222, 845: 223, 846: 224, 847: 225, 851: 226, 856: 227, 863: 228, 870: 229, 871: 230, 873: 231, 874: 232, 880: 233, 881: 234, 891: 235, 898: 236, 899: 237, 900: 238, 905: 239, 912: 240, 914: 241, 915: 242, 920: 243, 921: 244, 925: 245, 930: 246, 932: 247, 935: 248, 938: 249, 939: 250, 942: 251, 949: 252, 957: 253, 960: 254, 965: 255, 967: 256, 968: 257, 973: 258, 974: 259, 975: 260, 980: 261, 986: 262, 987: 263, 995: 264, 996: 265, 997: 266, 1000: 267, 1002: 268, 1010: 269, 1013: 270, 1015: 271, 1017: 272, 1024: 273, 1026: 274, 1027: 275, 1030: 276, 1056: 277, 1062: 278, 1063: 279, 1075: 280, 1076: 281, 1081: 282, 1101: 283, 1107: 284, 1110: 285, 1112: 286, 1113: 287, 1114: 288, 1117: 289, 1119: 290, 1122: 291, 1124: 292, 1126: 293, 1136: 294, 1140: 295, 1143: 296, 1146: 297, 1147: 298, 1148: 299, 1158: 300, 1160: 301, 1161: 302, 1164: 303, 1169: 304, 1170: 305, 1171: 306, 1175: 307, 1176: 308, 1178: 309, 1183: 310, 1194: 311, 1195: 312, 1196: 313, 1197: 314, 1198: 315, 1200: 316, 1207: 317, 1211: 318, 1212: 319, 1213: 320, 1216: 321, 1218: 322, 1225: 323, 1228: 324, 1230: 325, 1231: 326, 1238: 327, 1242: 328, 1245: 329, 1247: 330, 1248: 331, 1253: 332, 1259: 333, 1261: 334, 1272: 335, 1274: 336, 1277: 337, 1280: 338, 1287: 339, 1291: 340, 1293: 341, 1294: 342, 1302: 343, 1303: 344, 1307: 345, 1308: 346, 1311: 347, 1323: 348, 1327: 349, 1329: 350, 1335: 351, 1342: 352, 1347: 353, 1351: 354, 1352: 355, 1356: 356, 1357: 357, 1362: 358, 1363: 359, 1366: 360, 1367: 361, 1374: 362, 1375: 363, 1377: 364, 1378: 365, 1381: 366, 1383: 367, 1384: 368, 1393: 369, 1401: 370, 1410: 371, 1414: 372, 1416: 373, 1417: 374, 1433: 375, 1436: 376, 1438: 377, 1442: 378, 1444: 379, 1446: 380, 1467: 381, 1470: 382, 1471: 383, 1473: 384, 1478: 385, 1484: 386, 1485: 387, 1487: 388, 1489: 389, 1491: 390, 1492: 391, 1497: 392, 1500: 393, 1504: 394, 1505: 395, 1506: 396, 1513: 397, 1515: 398, 1516: 399, 1518: 400, 1530: 401, 1535: 402, 1538: 403, 1539: 404, 1542: 405, 1544: 406, 1548: 407, 1552: 408, 1556: 409, 1558: 410, 1561: 411, 1562: 412, 1569: 413, 1570: 414, 1574: 415, 1575: 416, 1579: 417, 1582: 418, 1586: 419, 1588: 420, 1598: 421, 1602: 422, 1603: 423, 1605: 424, 1608: 425, 1610: 426, 1611: 427, 1622: 428, 1624: 429, 1634: 430, 1635: 431, 1638: 432, 1641: 433, 1642: 434, 1644: 435, 1657: 436, 1660: 437, 1663: 438, 1664: 439, 1671: 440, 1672: 441, 1673: 442, 1675: 443, 1684: 444, 1685: 445, 1691: 446, 1692: 447, 1694: 448, 1697: 449, 1698: 450, 1701: 451, 1711: 452, 1714: 453, 1716: 454, 1719: 455, 1723: 456, 1724: 457, 1728: 458, 1731: 459, 1733: 460, 1738: 461, 1739: 462, 1742: 463, 1744: 464, 1749: 465, 1752: 466, 1767: 467, 1771: 468, 1774: 469, 1787: 470, 1789: 471, 1795: 472, 1796: 473, 1797: 474, 1806: 475, 1810: 476, 1813: 477, 1815: 478, 1823: 479, 1824: 480, 1834: 481, 1841: 482, 1842: 483, 1846: 484, 1848: 485, 1849: 486, 1850: 487, 1851: 488, 1856: 489, 1863: 490, 1868: 491, 1881: 492, 1884: 493, 1885: 494, 1886: 495, 1897: 496, 1901: 497, 1902: 498, 1906: 499, 1907: 500, 1912: 501, 1914: 502, 1915: 503, 1924: 504, 1932: 505, 1936: 506, 1939: 507, 1940: 508, 1944: 509, 1949: 510, 1953: 511, 1954: 512, 1967: 513, 1987: 514, 1998: 515, 2021: 516, 2024: 517, 2029: 518, 2030: 519, 2034: 520, 2035: 521, 2036: 522, 2038: 523, 2039: 524, 2042: 525, 2045: 526, 2048: 527, 2049: 528, 2051: 529, 2055: 530, 2063: 531}
# class2= {0: 0, 4: 1, 5: 2, 19: 3, 42: 4, 60: 5, 62: 6, 64: 7, 69: 8, 73: 9, 80: 10, 85: 11, 89: 12, 111: 13, 118: 14, 119: 15, 122: 16, 124: 17, 140: 18, 141: 19, 143: 20, 148: 21, 150: 22, 161: 23, 170: 24, 171: 25, 174: 26, 176: 27, 181: 28, 182: 29, 191: 30, 196: 31, 202: 32, 203: 33, 205: 34, 231: 35, 232: 36, 243: 37, 260: 38, 265: 39, 270: 40, 279: 41, 280: 42, 285: 43, 287: 44, 290: 45, 297: 46, 302: 47, 305: 48, 317: 49, 318: 50, 319: 51, 343: 52, 348: 53, 357: 54, 360: 55, 373: 56, 376: 57, 378: 58, 386: 59, 388: 60, 391: 61, 398: 62, 406: 63, 407: 64, 411: 65, 416: 66, 418: 67, 422: 68, 431: 69, 438: 70, 452: 71, 460: 72, 463: 73, 468: 74, 472: 75, 478: 76, 480: 77, 482: 78, 486: 79, 489: 80, 491: 81, 503: 82, 504: 83, 508: 84, 510: 85, 514: 86, 523: 87, 534: 88, 541: 89, 542: 90, 545: 91, 552: 92, 559: 93, 573: 94, 577: 95, 585: 96, 587: 97, 588: 98, 589: 99, 598: 100, 601: 101, 602: 102, 604: 103, 606: 104, 609: 105, 626: 106, 627: 107, 633: 108, 640: 109, 641: 110, 642: 111, 647: 112, 648: 113, 670: 114, 677: 115, 693: 116, 709: 117, 713: 118, 715: 119, 725: 120, 726: 121, 730: 122, 732: 123, 735: 124, 737: 125, 742: 126, 765: 127, 767: 128, 789: 129, 796: 130, 803: 131, 809: 132, 811: 133, 816: 134, 828: 135, 829: 136, 832: 137, 833: 138, 840: 139, 842: 140, 848: 141, 849: 142, 855: 143, 864: 144, 866: 145, 868: 146, 869: 147, 878: 148, 883: 149, 889: 150, 893: 151, 897: 152, 901: 153, 909: 154, 910: 155, 911: 156, 917: 157, 928: 158, 934: 159, 936: 160, 937: 161, 941: 162, 943: 163, 944: 164, 956: 165, 959: 166, 962: 167, 969: 168, 972: 169, 977: 170, 984: 171, 990: 172, 992: 173, 993: 174, 1005: 175, 1006: 176, 1008: 177, 1011: 178, 1019: 179, 1021: 180, 1023: 181, 1033: 182, 1041: 183, 1049: 184, 1053: 185, 1059: 186, 1060: 187, 1065: 188, 1071: 189, 1074: 190, 1084: 191, 1086: 192, 1090: 193, 1095: 194, 1098: 195, 1100: 196, 1115: 197, 1123: 198, 1128: 199, 1132: 200, 1133: 201, 1134: 202, 1142: 203, 1157: 204, 1159: 205, 1172: 206, 1182: 207, 1184: 208, 1188: 209, 1192: 210, 1193: 211, 1209: 212, 1214: 213, 1219: 214, 1221: 215, 1223: 216, 1227: 217, 1232: 218, 1239: 219, 1243: 220, 1249: 221, 1250: 222, 1252: 223, 1254: 224, 1255: 225, 1257: 226, 1262: 227, 1263: 228, 1265: 229, 1276: 230, 1283: 231, 1290: 232, 1295: 233, 1309: 234, 1312: 235, 1313: 236, 1314: 237, 1315: 238, 1326: 239, 1328: 240, 1332: 241, 1334: 242, 1338: 243, 1345: 244, 1346: 245, 1365: 246, 1370: 247, 1380: 248, 1391: 249, 1396: 250, 1398: 251, 1403: 252, 1409: 253, 1415: 254, 1419: 255, 1425: 256, 1428: 257, 1434: 258, 1435: 259, 1437: 260, 1441: 261, 1443: 262, 1449: 263, 1460: 264, 1468: 265, 1475: 266, 1479: 267, 1483: 268, 1494: 269, 1502: 270, 1503: 271, 1507: 272, 1509: 273, 1511: 274, 1514: 275, 1529: 276, 1533: 277, 1547: 278, 1550: 279, 1555: 280, 1557: 281, 1559: 282, 1567: 283, 1568: 284, 1573: 285, 1578: 286, 1580: 287, 1584: 288, 1594: 289, 1600: 290, 1601: 291, 1604: 292, 1617: 293, 1623: 294, 1637: 295, 1639: 296, 1645: 297, 1647: 298, 1651: 299, 1674: 300, 1689: 301, 1690: 302, 1703: 303, 1704: 304, 1712: 305, 1717: 306, 1722: 307, 1726: 308, 1734: 309, 1741: 310, 1750: 311, 1760: 312, 1761: 313, 1762: 314, 1768: 315, 1772: 316, 1775: 317, 1777: 318, 1783: 319, 1785: 320, 1790: 321, 1792: 322, 1799: 323, 1801: 324, 1802: 325, 1803: 326, 1811: 327, 1817: 328, 1820: 329, 1822: 330, 1829: 331, 1836: 332, 1843: 333, 1870: 334, 1871: 335, 1874: 336, 1878: 337, 1883: 338, 1894: 339, 1895: 340, 1896: 341, 1930: 342, 1948: 343, 1951: 344, 1957: 345, 1958: 346, 1966: 347, 1970: 348, 1971: 349, 1972: 350, 1978: 351, 1982: 352, 1986: 353, 1988: 354, 1990: 355, 1992: 356, 2001: 357, 2005: 358, 2014: 359, 2015: 360, 2018: 361, 2019: 362, 2022: 363, 2032: 364, 2037: 365, 2040: 366, 2059: 367, 2066: 368}
# class3= {13: 0, 20: 1, 22: 2, 23: 3, 27: 4, 40: 5, 49: 6, 57: 7, 72: 8, 84: 9, 86: 10, 101: 11, 123: 12, 125: 13, 127: 14, 134: 15, 142: 16, 147: 17, 151: 18, 152: 19, 167: 20, 173: 21, 179: 22, 180: 23, 184: 24, 199: 25, 200: 26, 224: 27, 245: 28, 255: 29, 259: 30, 261: 31, 264: 32, 274: 33, 275: 34, 277: 35, 286: 36, 288: 37, 294: 38, 301: 39, 308: 40, 310: 41, 311: 42, 314: 43, 316: 44, 329: 45, 330: 46, 331: 47, 347: 48, 354: 49, 355: 50, 358: 51, 362: 52, 379: 53, 383: 54, 423: 55, 426: 56, 449: 57, 455: 58, 462: 59, 473: 60, 476: 61, 481: 62, 506: 63, 517: 64, 539: 65, 543: 66, 548: 67, 549: 68, 567: 69, 569: 70, 571: 71, 578: 72, 584: 73, 593: 74, 599: 75, 600: 76, 617: 77, 618: 78, 622: 79, 632: 80, 649: 81, 655: 82, 663: 83, 666: 84, 668: 85, 681: 86, 688: 87, 697: 88, 703: 89, 717: 90, 731: 91, 748: 92, 749: 93, 751: 94, 755: 95, 757: 96, 771: 97, 778: 98, 783: 99, 790: 100, 798: 101, 802: 102, 808: 103, 813: 104, 817: 105, 818: 106, 838: 107, 894: 108, 907: 109, 913: 110, 916: 111, 918: 112, 922: 113, 933: 114, 945: 115, 955: 116, 963: 117, 964: 118, 966: 119, 991: 120, 998: 121, 1009: 122, 1012: 123, 1018: 124, 1020: 125, 1031: 126, 1032: 127, 1035: 128, 1038: 129, 1046: 130, 1055: 131, 1067: 132, 1077: 133, 1078: 134, 1079: 135, 1091: 136, 1106: 137, 1109: 138, 1116: 139, 1131: 140, 1139: 141, 1150: 142, 1152: 143, 1163: 144, 1166: 145, 1181: 146, 1185: 147, 1201: 148, 1237: 149, 1241: 150, 1246: 151, 1267: 152, 1268: 153, 1270: 154, 1271: 155, 1278: 156, 1279: 157, 1281: 158, 1289: 159, 1296: 160, 1319: 161, 1322: 162, 1337: 163, 1348: 164, 1349: 165, 1350: 166, 1361: 167, 1379: 168, 1385: 169, 1387: 170, 1450: 171, 1451: 172, 1454: 173, 1457: 174, 1466: 175, 1469: 176, 1488: 177, 1510: 178, 1520: 179, 1526: 180, 1528: 181, 1534: 182, 1536: 183, 1545: 184, 1563: 185, 1564: 186, 1566: 187, 1577: 188, 1596: 189, 1615: 190, 1625: 191, 1627: 192, 1633: 193, 1655: 194, 1666: 195, 1669: 196, 1677: 197, 1688: 198, 1709: 199, 1732: 200, 1737: 201, 1740: 202, 1746: 203, 1755: 204, 1757: 205, 1764: 206, 1778: 207, 1782: 208, 1784: 209, 1788: 210, 1793: 211, 1800: 212, 1804: 213, 1821: 214, 1826: 215, 1830: 216, 1838: 217, 1839: 218, 1854: 219, 1857: 220, 1869: 221, 1875: 222, 1877: 223, 1879: 224, 1888: 225, 1904: 226, 1909: 227, 1918: 228, 1937: 229, 1942: 230, 1943: 231, 1946: 232, 1956: 233, 1962: 234, 1965: 235, 1974: 236, 1975: 237, 1985: 238, 1991: 239, 1996: 240, 1999: 241, 2000: 242, 2002: 243, 2003: 244, 2010: 245, 2017: 246, 2023: 247, 2025: 248, 2028: 249, 2043: 250, 2060: 251, 2064: 252}
# class4= {3: 0, 9: 1, 11: 2, 12: 3, 14: 4, 16: 5, 28: 6, 30: 7, 31: 8, 32: 9, 37: 10, 39: 11, 44: 12, 48: 13, 52: 14, 53: 15, 56: 16, 67: 17, 68: 18, 70: 19, 75: 20, 76: 21, 77: 22, 78: 23, 81: 24, 82: 25, 87: 26, 90: 27, 92: 28, 93: 29, 95: 30, 96: 31, 98: 32, 103: 33, 105: 34, 107: 35, 109: 36, 117: 37, 133: 38, 135: 39, 138: 40, 139: 41, 144: 42, 146: 43, 154: 44, 158: 45, 160: 46, 165: 47, 166: 48, 177: 49, 185: 50, 188: 51, 189: 52, 192: 53, 193: 54, 194: 55, 201: 56, 207: 57, 209: 58, 216: 59, 217: 60, 218: 61, 221: 62, 223: 63, 226: 64, 227: 65, 228: 66, 230: 67, 234: 68, 240: 69, 242: 70, 244: 71, 246: 72, 248: 73, 249: 74, 250: 75, 251: 76, 252: 77, 253: 78, 254: 79, 256: 80, 257: 81, 267: 82, 268: 83, 269: 84, 272: 85, 282: 86, 283: 87, 289: 88, 296: 89, 299: 90, 300: 91, 306: 92, 307: 93, 313: 94, 320: 95, 323: 96, 324: 97, 328: 98, 333: 99, 337: 100, 338: 101, 339: 102, 340: 103, 341: 104, 344: 105, 350: 106, 351: 107, 352: 108, 353: 109, 356: 110, 361: 111, 364: 112, 365: 113, 367: 114, 368: 115, 371: 116, 385: 117, 389: 118, 390: 119, 395: 120, 396: 121, 400: 122, 401: 123, 402: 124, 404: 125, 405: 126, 412: 127, 415: 128, 417: 129, 419: 130, 420: 131, 421: 132, 424: 133, 425: 134, 429: 135, 434: 136, 437: 137, 439: 138, 440: 139, 442: 140, 443: 141, 446: 142, 451: 143, 453: 144, 456: 145, 458: 146, 459: 147, 461: 148, 464: 149, 469: 150, 470: 151, 475: 152, 477: 153, 479: 154, 483: 155, 484: 156, 494: 157, 495: 158, 497: 159, 498: 160, 501: 161, 502: 162, 507: 163, 509: 164, 512: 165, 515: 166, 520: 167, 521: 168, 522: 169, 524: 170, 525: 171, 528: 172, 529: 173, 530: 174, 532: 175, 535: 176, 537: 177, 538: 178, 540: 179, 544: 180, 550: 181, 551: 182, 557: 183, 560: 184, 561: 185, 562: 186, 564: 187, 566: 188, 575: 189, 580: 190, 581: 191, 582: 192, 595: 193, 596: 194, 603: 195, 605: 196, 607: 197, 611: 198, 615: 199, 620: 200, 621: 201, 624: 202, 625: 203, 629: 204, 630: 205, 634: 206, 637: 207, 638: 208, 644: 209, 645: 210, 646: 211, 653: 212, 656: 213, 660: 214, 661: 215, 675: 216, 683: 217, 684: 218, 686: 219, 687: 220, 692: 221, 695: 222, 696: 223, 700: 224, 702: 225, 704: 226, 707: 227, 711: 228, 714: 229, 723: 230, 724: 231, 733: 232, 734: 233, 738: 234, 741: 235, 743: 236, 754: 237, 756: 238, 759: 239, 763: 240, 768: 241, 774: 242, 776: 243, 781: 244, 782: 245, 784: 246, 792: 247, 793: 248, 794: 249, 799: 250, 801: 251, 805: 252, 810: 253, 815: 254, 821: 255, 823: 256, 827: 257, 830: 258, 834: 259, 843: 260, 853: 261, 857: 262, 858: 263, 859: 264, 861: 265, 862: 266, 865: 267, 867: 268, 875: 269, 876: 270, 877: 271, 884: 272, 885: 273, 886: 274, 887: 275, 888: 276, 892: 277, 895: 278, 896: 279, 908: 280, 919: 281, 924: 282, 926: 283, 927: 284, 929: 285, 931: 286, 940: 287, 946: 288, 948: 289, 950: 290, 951: 291, 952: 292, 953: 293, 961: 294, 970: 295, 976: 296, 978: 297, 979: 298, 983: 299, 985: 300, 988: 301, 994: 302, 999: 303, 1001: 304, 1003: 305, 1004: 306, 1007: 307, 1025: 308, 1028: 309, 1029: 310, 1034: 311, 1037: 312, 1039: 313, 1043: 314, 1044: 315, 1045: 316, 1047: 317, 1048: 318, 1050: 319, 1052: 320, 1054: 321, 1058: 322, 1061: 323, 1066: 324, 1069: 325, 1070: 326, 1073: 327, 1080: 328, 1082: 329, 1087: 330, 1088: 331, 1089: 332, 1092: 333, 1093: 334, 1097: 335, 1099: 336, 1102: 337, 1103: 338, 1104: 339, 1105: 340, 1118: 341, 1121: 342, 1125: 343, 1127: 344, 1129: 345, 1130: 346, 1135: 347, 1137: 348, 1138: 349, 1145: 350, 1149: 351, 1151: 352, 1153: 353, 1154: 354, 1155: 355, 1156: 356, 1165: 357, 1167: 358, 1168: 359, 1174: 360, 1177: 361, 1179: 362, 1180: 363, 1187: 364, 1191: 365, 1199: 366, 1202: 367, 1203: 368, 1204: 369, 1205: 370, 1206: 371, 1208: 372, 1215: 373, 1220: 374, 1222: 375, 1224: 376, 1226: 377, 1229: 378, 1233: 379, 1235: 380, 1244: 381, 1251: 382, 1256: 383, 1260: 384, 1264: 385, 1266: 386, 1273: 387, 1275: 388, 1282: 389, 1286: 390, 1297: 391, 1299: 392, 1300: 393, 1301: 394, 1305: 395, 1306: 396, 1310: 397, 1316: 398, 1318: 399, 1320: 400, 1321: 401, 1324: 402, 1330: 403, 1331: 404, 1339: 405, 1341: 406, 1344: 407, 1354: 408, 1359: 409, 1360: 410, 1364: 411, 1368: 412, 1371: 413, 1372: 414, 1373: 415, 1376: 416, 1382: 417, 1386: 418, 1388: 419, 1389: 420, 1390: 421, 1392: 422, 1394: 423, 1395: 424, 1397: 425, 1399: 426, 1404: 427, 1406: 428, 1407: 429, 1408: 430, 1411: 431, 1412: 432, 1413: 433, 1421: 434, 1423: 435, 1424: 436, 1426: 437, 1429: 438, 1432: 439, 1439: 440, 1440: 441, 1445: 442, 1447: 443, 1448: 444, 1452: 445, 1455: 446, 1456: 447, 1462: 448, 1463: 449, 1465: 450, 1472: 451, 1474: 452, 1476: 453, 1477: 454, 1480: 455, 1490: 456, 1493: 457, 1495: 458, 1496: 459, 1498: 460, 1508: 461, 1517: 462, 1519: 463, 1523: 464, 1524: 465, 1527: 466, 1531: 467, 1537: 468, 1540: 469, 1543: 470, 1549: 471, 1551: 472, 1553: 473, 1554: 474, 1560: 475, 1565: 476, 1571: 477, 1572: 478, 1576: 479, 1585: 480, 1587: 481, 1589: 482, 1590: 483, 1591: 484, 1593: 485, 1595: 486, 1597: 487, 1599: 488, 1606: 489, 1609: 490, 1612: 491, 1614: 492, 1618: 493, 1619: 494, 1620: 495, 1621: 496, 1626: 497, 1628: 498, 1630: 499, 1632: 500, 1636: 501, 1640: 502, 1643: 503, 1646: 504, 1648: 505, 1650: 506, 1654: 507, 1656: 508, 1658: 509, 1661: 510, 1662: 511, 1665: 512, 1670: 513, 1676: 514, 1678: 515, 1679: 516, 1680: 517, 1682: 518, 1683: 519, 1686: 520, 1687: 521, 1693: 522, 1695: 523, 1696: 524, 1699: 525, 1700: 526, 1702: 527, 1707: 528, 1708: 529, 1713: 530, 1720: 531, 1721: 532, 1725: 533, 1727: 534, 1729: 535, 1730: 536, 1735: 537, 1745: 538, 1747: 539, 1748: 540, 1751: 541, 1753: 542, 1756: 543, 1758: 544, 1759: 545, 1763: 546, 1769: 547, 1770: 548, 1773: 549, 1776: 550, 1779: 551, 1780: 552, 1791: 553, 1794: 554, 1798: 555, 1805: 556, 1807: 557, 1809: 558, 1814: 559, 1827: 560, 1828: 561, 1831: 562, 1835: 563, 1837: 564, 1840: 565, 1844: 566, 1845: 567, 1853: 568, 1855: 569, 1858: 570, 1859: 571, 1860: 572, 1862: 573, 1864: 574, 1867: 575, 1873: 576, 1876: 577, 1880: 578, 1887: 579, 1889: 580, 1890: 581, 1891: 582, 1893: 583, 1898: 584, 1899: 585, 1900: 586, 1903: 587, 1905: 588, 1908: 589, 1910: 590, 1911: 591, 1916: 592, 1919: 593, 1921: 594, 1922: 595, 1925: 596, 1926: 597, 1931: 598, 1933: 599, 1934: 600, 1935: 601, 1938: 602, 1941: 603, 1947: 604, 1950: 605, 1952: 606, 1955: 607, 1960: 608, 1961: 609, 1963: 610, 1964: 611, 1968: 612, 1969: 613, 1973: 614, 1976: 615, 1977: 616, 1981: 617, 1983: 618, 1984: 619, 1989: 620, 1993: 621, 1994: 622, 1995: 623, 1997: 624, 2004: 625, 2006: 626, 2009: 627, 2012: 628, 2013: 629, 2016: 630, 2020: 631, 2026: 632, 2027: 633, 2031: 634, 2033: 635, 2044: 636, 2050: 637, 2052: 638, 2053: 639, 2054: 640, 2056: 641, 2057: 642, 2061: 643, 2065: 644}
class0= {3: 0, 5: 1, 9: 2, 28: 3, 31: 4, 53: 5, 56: 6, 68: 7, 75: 8, 77: 9, 81: 10, 87: 11, 90: 12, 92: 13, 93: 14, 96: 15, 98: 16, 103: 17, 105: 18, 109: 19, 117: 20, 138: 21, 139: 22, 144: 23, 158: 24, 160: 25, 165: 26, 174: 27, 177: 28, 188: 29, 189: 30, 192: 31, 194: 32, 196: 33, 201: 34, 218: 35, 221: 36, 227: 37, 230: 38, 240: 39, 244: 40, 248: 41, 251: 42, 252: 43, 256: 44, 257: 45, 268: 46, 269: 47, 272: 48, 282: 49, 283: 50, 289: 51, 296: 52, 299: 53, 300: 54, 306: 55, 307: 56, 320: 57, 324: 58, 338: 59, 339: 60, 341: 61, 351: 62, 352: 63, 356: 64, 361: 65, 364: 66, 365: 67, 367: 68, 386: 69, 389: 70, 390: 71, 395: 72, 402: 73, 412: 74, 415: 75, 419: 76, 420: 77, 421: 78, 429: 79, 434: 80, 439: 81, 442: 82, 446: 83, 451: 84, 453: 85, 456: 86, 458: 87, 461: 88, 464: 89, 468: 90, 469: 91, 477: 92, 479: 93, 483: 94, 484: 95, 495: 96, 497: 97, 501: 98, 502: 99, 507: 100, 509: 101, 512: 102, 515: 103, 520: 104, 521: 105, 524: 106, 525: 107, 530: 108, 532: 109, 535: 110, 537: 111, 538: 112, 540: 113, 544: 114, 551: 115, 557: 116, 560: 117, 561: 118, 564: 119, 566: 120, 580: 121, 581: 122, 596: 123, 605: 124, 611: 125, 615: 126, 621: 127, 624: 128, 625: 129, 630: 130, 637: 131, 638: 132, 645: 133, 648: 134, 653: 135, 656: 136, 660: 137, 686: 138, 687: 139, 696: 140, 700: 141, 707: 142, 714: 143, 723: 144, 724: 145, 734: 146, 738: 147, 741: 148, 768: 149, 776: 150, 782: 151, 784: 152, 792: 153, 793: 154, 794: 155, 799: 156, 810: 157, 821: 158, 827: 159, 830: 160, 834: 161, 853: 162, 857: 163, 858: 164, 859: 165, 862: 166, 867: 167, 876: 168, 877: 169, 884: 170, 885: 171, 886: 172, 887: 173, 888: 174, 924: 175, 926: 176, 927: 177, 929: 178, 931: 179, 937: 180, 940: 181, 952: 182, 953: 183, 961: 184, 970: 185, 978: 186, 979: 187, 983: 188, 985: 189, 994: 190, 1001: 191, 1003: 192, 1007: 193, 1025: 194, 1034: 195, 1043: 196, 1044: 197, 1047: 198, 1048: 199, 1054: 200, 1061: 201, 1069: 202, 1070: 203, 1082: 204, 1097: 205, 1099: 206, 1103: 207, 1104: 208, 1125: 209, 1127: 210, 1129: 211, 1130: 212, 1135: 213, 1137: 214, 1138: 215, 1145: 216, 1154: 217, 1165: 218, 1167: 219, 1168: 220, 1174: 221, 1177: 222, 1187: 223, 1191: 224, 1193: 225, 1203: 226, 1206: 227, 1208: 228, 1215: 229, 1220: 230, 1224: 231, 1226: 232, 1229: 233, 1235: 234, 1244: 235, 1251: 236, 1264: 237, 1266: 238, 1273: 239, 1275: 240, 1276: 241, 1282: 242, 1286: 243, 1297: 244, 1299: 245, 1301: 246, 1310: 247, 1316: 248, 1318: 249, 1320: 250, 1324: 251, 1330: 252, 1331: 253, 1341: 254, 1344: 255, 1354: 256, 1359: 257, 1360: 258, 1368: 259, 1371: 260, 1372: 261, 1373: 262, 1382: 263, 1386: 264, 1390: 265, 1395: 266, 1404: 267, 1407: 268, 1408: 269, 1411: 270, 1412: 271, 1413: 272, 1421: 273, 1423: 274, 1432: 275, 1439: 276, 1447: 277, 1462: 278, 1463: 279, 1465: 280, 1476: 281, 1477: 282, 1480: 283, 1493: 284, 1495: 285, 1496: 286, 1498: 287, 1508: 288, 1517: 289, 1523: 290, 1524: 291, 1531: 292, 1553: 293, 1560: 294, 1571: 295, 1572: 296, 1576: 297, 1585: 298, 1587: 299, 1589: 300, 1591: 301, 1597: 302, 1599: 303, 1606: 304, 1612: 305, 1614: 306, 1618: 307, 1620: 308, 1621: 309, 1626: 310, 1628: 311, 1630: 312, 1632: 313, 1636: 314, 1640: 315, 1643: 316, 1650: 317, 1658: 318, 1670: 319, 1678: 320, 1680: 321, 1682: 322, 1683: 323, 1686: 324, 1687: 325, 1693: 326, 1695: 327, 1699: 328, 1702: 329, 1707: 330, 1708: 331, 1713: 332, 1729: 333, 1730: 334, 1735: 335, 1745: 336, 1748: 337, 1759: 338, 1763: 339, 1769: 340, 1770: 341, 1773: 342, 1776: 343, 1791: 344, 1807: 345, 1809: 346, 1814: 347, 1828: 348, 1831: 349, 1835: 350, 1840: 351, 1844: 352, 1853: 353, 1858: 354, 1859: 355, 1860: 356, 1873: 357, 1887: 358, 1889: 359, 1890: 360, 1891: 361, 1893: 362, 1900: 363, 1903: 364, 1910: 365, 1911: 366, 1921: 367, 1925: 368, 1931: 369, 1933: 370, 1934: 371, 1935: 372, 1938: 373, 1941: 374, 1947: 375, 1955: 376, 1963: 377, 1964: 378, 1969: 379, 1981: 380, 1983: 381, 1984: 382, 1989: 383, 1993: 384, 1994: 385, 2004: 386, 2009: 387, 2013: 388, 2015: 389, 2016: 390, 2019: 391, 2027: 392, 2033: 393, 2044: 394, 2050: 395, 2053: 396, 2054: 397, 2056: 398, 2061: 399}
class1= {14: 0, 29: 1, 33: 2, 34: 3, 37: 4, 39: 5, 54: 6, 58: 7, 61: 8, 65: 9, 71: 10, 83: 11, 91: 12, 99: 13, 113: 14, 114: 15, 115: 16, 116: 17, 126: 18, 133: 19, 135: 20, 136: 21, 146: 22, 159: 23, 168: 24, 169: 25, 175: 26, 183: 27, 185: 28, 204: 29, 209: 30, 216: 31, 217: 32, 226: 33, 229: 34, 233: 35, 234: 36, 235: 37, 238: 38, 242: 39, 246: 40, 249: 41, 250: 42, 254: 43, 258: 44, 263: 45, 321: 46, 322: 47, 323: 48, 333: 49, 335: 50, 337: 51, 344: 52, 346: 53, 350: 54, 353: 55, 363: 56, 369: 57, 371: 58, 372: 59, 377: 60, 387: 61, 396: 62, 397: 63, 401: 64, 404: 65, 405: 66, 410: 67, 414: 68, 417: 69, 425: 70, 430: 71, 433: 72, 435: 73, 440: 74, 443: 75, 447: 76, 467: 77, 470: 78, 475: 79, 487: 80, 494: 81, 496: 82, 498: 83, 513: 84, 516: 85, 522: 86, 528: 87, 556: 88, 565: 89, 574: 90, 595: 91, 597: 92, 608: 93, 610: 94, 620: 95, 623: 96, 628: 97, 634: 98, 635: 99, 644: 100, 646: 101, 650: 102, 654: 103, 661: 104, 662: 105, 664: 106, 669: 107, 675: 108, 676: 109, 678: 110, 679: 111, 683: 112, 690: 113, 694: 114, 699: 115, 704: 116, 705: 117, 711: 118, 722: 119, 743: 120, 750: 121, 753: 122, 760: 123, 763: 124, 769: 125, 774: 126, 775: 127, 786: 128, 788: 129, 804: 130, 805: 131, 815: 132, 822: 133, 825: 134, 841: 135, 843: 136, 845: 137, 847: 138, 851: 139, 861: 140, 865: 141, 875: 142, 892: 143, 896: 144, 903: 145, 908: 146, 914: 147, 915: 148, 919: 149, 920: 150, 921: 151, 939: 152, 946: 153, 948: 154, 949: 155, 968: 156, 1002: 157, 1010: 158, 1017: 159, 1029: 160, 1030: 161, 1037: 162, 1045: 163, 1050: 164, 1052: 165, 1058: 166, 1066: 167, 1075: 168, 1088: 169, 1092: 170, 1102: 171, 1112: 172, 1121: 173, 1147: 174, 1151: 175, 1153: 176, 1155: 177, 1161: 178, 1175: 179, 1180: 180, 1189: 181, 1195: 182, 1197: 183, 1204: 184, 1205: 185, 1217: 186, 1218: 187, 1222: 188, 1247: 189, 1258: 190, 1305: 191, 1307: 192, 1329: 193, 1339: 194, 1347: 195, 1356: 196, 1357: 197, 1376: 198, 1388: 199, 1389: 200, 1392: 201, 1399: 202, 1401: 203, 1424: 204, 1426: 205, 1436: 206, 1438: 207, 1445: 208, 1448: 209, 1455: 210, 1456: 211, 1467: 212, 1472: 213, 1474: 214, 1478: 215, 1482: 216, 1490: 217, 1492: 218, 1500: 219, 1505: 220, 1506: 221, 1516: 222, 1543: 223, 1544: 224, 1548: 225, 1549: 226, 1551: 227, 1554: 228, 1558: 229, 1565: 230, 1588: 231, 1590: 232, 1595: 233, 1609: 234, 1619: 235, 1638: 236, 1641: 237, 1642: 238, 1644: 239, 1654: 240, 1656: 241, 1660: 242, 1661: 243, 1672: 244, 1673: 245, 1675: 246, 1676: 247, 1679: 248, 1691: 249, 1696: 250, 1714: 251, 1720: 252, 1738: 253, 1742: 254, 1751: 255, 1795: 256, 1806: 257, 1812: 258, 1824: 259, 1834: 260, 1837: 261, 1845: 262, 1849: 263, 1850: 264, 1864: 265, 1872: 266, 1876: 267, 1880: 268, 1884: 269, 1885: 270, 1897: 271, 1898: 272, 1915: 273, 1922: 274, 1950: 275, 1953: 276, 1959: 277, 1967: 278, 1968: 279, 1973: 280, 1976: 281, 1977: 282, 2012: 283, 2024: 284, 2035: 285, 2036: 286, 2057: 287, 2058: 288, 2065: 289}
class2= {42: 0, 62: 1, 64: 2, 80: 3, 111: 4, 119: 5, 143: 6, 161: 7, 171: 8, 176: 9, 191: 10, 197: 11, 219: 12, 231: 13, 243: 14, 260: 15, 265: 16, 280: 17, 297: 18, 302: 19, 317: 20, 318: 21, 319: 22, 360: 23, 373: 24, 376: 25, 378: 26, 406: 27, 407: 28, 416: 29, 418: 30, 422: 31, 431: 32, 460: 33, 463: 34, 472: 35, 478: 36, 482: 37, 486: 38, 489: 39, 510: 40, 514: 41, 541: 42, 559: 43, 573: 44, 577: 45, 585: 46, 588: 47, 589: 48, 604: 49, 606: 50, 609: 51, 633: 52, 640: 53, 641: 54, 642: 55, 647: 56, 670: 57, 709: 58, 713: 59, 715: 60, 730: 61, 735: 62, 737: 63, 767: 64, 789: 65, 809: 66, 811: 67, 816: 68, 828: 69, 833: 70, 842: 71, 848: 72, 849: 73, 866: 74, 868: 75, 869: 76, 878: 77, 883: 78, 889: 79, 911: 80, 917: 81, 928: 82, 936: 83, 942: 84, 944: 85, 959: 86, 962: 87, 969: 88, 990: 89, 1005: 90, 1006: 91, 1011: 92, 1019: 93, 1023: 94, 1041: 95, 1049: 96, 1053: 97, 1060: 98, 1071: 99, 1084: 100, 1090: 101, 1095: 102, 1100: 103, 1115: 104, 1119: 105, 1132: 106, 1133: 107, 1157: 108, 1159: 109, 1188: 110, 1192: 111, 1212: 112, 1219: 113, 1221: 114, 1232: 115, 1239: 116, 1249: 117, 1250: 118, 1254: 119, 1257: 120, 1262: 121, 1265: 122, 1283: 123, 1295: 124, 1309: 125, 1313: 126, 1314: 127, 1315: 128, 1332: 129, 1334: 130, 1338: 131, 1345: 132, 1346: 133, 1370: 134, 1380: 135, 1396: 136, 1398: 137, 1409: 138, 1425: 139, 1443: 140, 1460: 141, 1479: 142, 1483: 143, 1494: 144, 1503: 145, 1514: 146, 1533: 147, 1547: 148, 1550: 149, 1555: 150, 1559: 151, 1568: 152, 1573: 153, 1578: 154, 1580: 155, 1594: 156, 1601: 157, 1623: 158, 1637: 159, 1639: 160, 1645: 161, 1651: 162, 1689: 163, 1690: 164, 1703: 165, 1704: 166, 1717: 167, 1722: 168, 1750: 169, 1760: 170, 1762: 171, 1772: 172, 1777: 173, 1783: 174, 1785: 175, 1792: 176, 1799: 177, 1822: 178, 1829: 179, 1836: 180, 1843: 181, 1870: 182, 1871: 183, 1878: 184, 1883: 185, 1896: 186, 1930: 187, 1948: 188, 1971: 189, 1972: 190, 1978: 191, 1982: 192, 1986: 193, 1988: 194, 1990: 195, 2001: 196, 2005: 197, 2022: 198, 2032: 199, 2037: 200, 2045: 201, 2049: 202, 2066: 203}
class3= {10: 0, 18: 1, 24: 2, 26: 3, 36: 4, 59: 5, 63: 6, 88: 7, 97: 8, 120: 9, 121: 10, 129: 11, 130: 12, 131: 13, 153: 14, 157: 15, 162: 16, 164: 17, 178: 18, 187: 19, 195: 20, 210: 21, 211: 22, 212: 23, 220: 24, 225: 25, 236: 26, 266: 27, 271: 28, 281: 29, 284: 30, 293: 31, 303: 32, 304: 33, 325: 34, 327: 35, 332: 36, 334: 37, 336: 38, 359: 39, 366: 40, 370: 41, 380: 42, 393: 43, 394: 44, 399: 45, 413: 46, 428: 47, 432: 48, 450: 49, 454: 50, 457: 51, 474: 52, 492: 53, 499: 54, 518: 55, 533: 56, 546: 57, 558: 58, 570: 59, 572: 60, 576: 61, 579: 62, 583: 63, 614: 64, 616: 65, 619: 66, 636: 67, 639: 68, 643: 69, 651: 70, 657: 71, 658: 72, 659: 73, 665: 74, 667: 75, 672: 76, 673: 77, 682: 78, 716: 79, 719: 80, 739: 81, 740: 82, 744: 83, 751: 84, 758: 85, 762: 86, 764: 87, 773: 88, 785: 89, 787: 90, 797: 91, 812: 92, 826: 93, 835: 94, 836: 95, 850: 96, 852: 97, 854: 98, 860: 99, 872: 100, 879: 101, 882: 102, 890: 103, 902: 104, 904: 105, 906: 106, 923: 107, 947: 108, 954: 109, 958: 110, 971: 111, 981: 112, 982: 113, 1014: 114, 1016: 115, 1022: 116, 1036: 117, 1040: 118, 1042: 119, 1051: 120, 1057: 121, 1064: 122, 1068: 123, 1072: 124, 1083: 125, 1085: 126, 1094: 127, 1096: 128, 1108: 129, 1111: 130, 1120: 131, 1144: 132, 1162: 133, 1173: 134, 1186: 135, 1190: 136, 1234: 137, 1236: 138, 1240: 139, 1269: 140, 1284: 141, 1288: 142, 1292: 143, 1325: 144, 1333: 145, 1336: 146, 1340: 147, 1343: 148, 1355: 149, 1358: 150, 1369: 151, 1400: 152, 1402: 153, 1405: 154, 1418: 155, 1420: 156, 1422: 157, 1427: 158, 1430: 159, 1431: 160, 1453: 161, 1458: 162, 1459: 163, 1461: 164, 1464: 165, 1486: 166, 1499: 167, 1512: 168, 1520: 169, 1521: 170, 1522: 171, 1525: 172, 1532: 173, 1541: 174, 1546: 175, 1581: 176, 1583: 177, 1592: 178, 1607: 179, 1613: 180, 1629: 181, 1631: 182, 1649: 183, 1652: 184, 1653: 185, 1659: 186, 1667: 187, 1668: 188, 1705: 189, 1706: 190, 1710: 191, 1715: 192, 1718: 193, 1736: 194, 1765: 195, 1766: 196, 1781: 197, 1786: 198, 1808: 199, 1816: 200, 1818: 201, 1819: 202, 1825: 203, 1832: 204, 1833: 205, 1847: 206, 1852: 207, 1861: 208, 1865: 209, 1866: 210, 1882: 211, 1892: 212, 1917: 213, 1920: 214, 1923: 215, 1927: 216, 1928: 217, 1929: 218, 1945: 219, 1980: 220, 2007: 221, 2008: 222, 2011: 223, 2025: 224, 2041: 225, 2047: 226, 2067: 227}
class4= {23: 0, 27: 1, 49: 2, 72: 3, 123: 4, 134: 5, 142: 6, 147: 7, 152: 8, 167: 9, 179: 10, 180: 11, 200: 12, 224: 13, 245: 14, 259: 15, 264: 16, 275: 17, 277: 18, 286: 19, 288: 20, 294: 21, 301: 22, 310: 23, 314: 24, 329: 25, 362: 26, 379: 27, 384: 28, 423: 29, 449: 30, 506: 31, 539: 32, 548: 33, 567: 34, 569: 35, 578: 36, 584: 37, 593: 38, 599: 39, 617: 40, 618: 41, 622: 42, 649: 43, 666: 44, 668: 45, 697: 46, 717: 47, 728: 48, 748: 49, 755: 50, 757: 51, 778: 52, 783: 53, 798: 54, 808: 55, 813: 56, 818: 57, 831: 58, 838: 59, 894: 60, 913: 61, 963: 62, 989: 63, 991: 64, 998: 65, 1009: 66, 1012: 67, 1020: 68, 1031: 69, 1035: 70, 1038: 71, 1067: 72, 1077: 73, 1078: 74, 1109: 75, 1131: 76, 1139: 77, 1150: 78, 1163: 79, 1181: 80, 1201: 81, 1237: 82, 1241: 83, 1278: 84, 1279: 85, 1281: 86, 1289: 87, 1317: 88, 1337: 89, 1348: 90, 1361: 91, 1379: 92, 1385: 93, 1450: 94, 1451: 95, 1454: 96, 1457: 97, 1466: 98, 1469: 99, 1481: 100, 1501: 101, 1528: 102, 1536: 103, 1545: 104, 1563: 105, 1564: 106, 1596: 107, 1615: 108, 1616: 109, 1625: 110, 1627: 111, 1655: 112, 1669: 113, 1677: 114, 1732: 115, 1757: 116, 1764: 117, 1778: 118, 1784: 119, 1788: 120, 1804: 121, 1826: 122, 1838: 123, 1857: 124, 1875: 125, 1879: 126, 1888: 127, 1904: 128, 1946: 129, 1956: 130, 1965: 131, 1985: 132, 1991: 133, 1996: 134, 1999: 135, 2002: 136, 2010: 137, 2060: 138, 2062: 139}
class5= {1: 0, 8: 1, 15: 2, 17: 3, 21: 4, 35: 5, 38: 6, 47: 7, 50: 8, 51: 9, 66: 10, 79: 11, 104: 12, 108: 13, 110: 14, 112: 15, 128: 16, 132: 17, 137: 18, 155: 19, 163: 20, 172: 21, 186: 22, 190: 23, 198: 24, 206: 25, 213: 26, 222: 27, 237: 28, 247: 29, 273: 30, 276: 31, 278: 32, 279: 33, 291: 34, 292: 35, 309: 36, 312: 37, 315: 38, 345: 39, 374: 40, 375: 41, 382: 42, 392: 43, 408: 44, 427: 45, 436: 46, 441: 47, 444: 48, 445: 49, 466: 50, 471: 51, 485: 52, 488: 53, 490: 54, 493: 55, 503: 56, 511: 57, 519: 58, 526: 59, 527: 60, 536: 61, 547: 62, 553: 63, 554: 64, 555: 65, 568: 66, 586: 67, 590: 68, 591: 69, 592: 70, 613: 71, 631: 72, 671: 73, 674: 74, 680: 75, 685: 76, 691: 77, 698: 78, 701: 79, 708: 80, 712: 81, 718: 82, 720: 83, 721: 84, 727: 85, 729: 86, 746: 87, 747: 88, 752: 89, 770: 90, 772: 91, 777: 92, 779: 93, 780: 94, 791: 95, 806: 96, 807: 97, 814: 98, 819: 99, 820: 100, 824: 101, 837: 102, 839: 103, 844: 104, 863: 105, 870: 106, 871: 107, 874: 108, 880: 109, 881: 110, 891: 111, 898: 112, 900: 113, 905: 114, 909: 115, 925: 116, 930: 117, 932: 118, 935: 119, 938: 120, 943: 121, 957: 122, 960: 123, 965: 124, 967: 125, 974: 126, 975: 127, 977: 128, 980: 129, 986: 130, 995: 131, 1000: 132, 1024: 133, 1027: 134, 1056: 135, 1062: 136, 1081: 137, 1101: 138, 1107: 139, 1113: 140, 1114: 141, 1117: 142, 1122: 143, 1126: 144, 1136: 145, 1146: 146, 1158: 147, 1160: 148, 1164: 149, 1169: 150, 1170: 151, 1176: 152, 1178: 153, 1183: 154, 1194: 155, 1196: 156, 1198: 157, 1200: 158, 1207: 159, 1211: 160, 1213: 161, 1216: 162, 1225: 163, 1228: 164, 1230: 165, 1231: 166, 1238: 167, 1245: 168, 1253: 169, 1261: 170, 1272: 171, 1274: 172, 1277: 173, 1280: 174, 1287: 175, 1291: 176, 1293: 177, 1294: 178, 1302: 179, 1303: 180, 1308: 181, 1311: 182, 1323: 183, 1327: 184, 1335: 185, 1351: 186, 1352: 187, 1362: 188, 1363: 189, 1366: 190, 1367: 191, 1375: 192, 1377: 193, 1384: 194, 1410: 195, 1414: 196, 1416: 197, 1417: 198, 1444: 199, 1446: 200, 1470: 201, 1471: 202, 1484: 203, 1485: 204, 1487: 205, 1489: 206, 1491: 207, 1497: 208, 1504: 209, 1513: 210, 1518: 211, 1535: 212, 1538: 213, 1542: 214, 1556: 215, 1561: 216, 1562: 217, 1569: 218, 1570: 219, 1574: 220, 1575: 221, 1579: 222, 1586: 223, 1598: 224, 1603: 225, 1605: 226, 1610: 227, 1611: 228, 1622: 229, 1624: 230, 1634: 231, 1657: 232, 1664: 233, 1692: 234, 1694: 235, 1697: 236, 1698: 237, 1701: 238, 1711: 239, 1716: 240, 1719: 241, 1723: 242, 1724: 243, 1728: 244, 1739: 245, 1744: 246, 1752: 247, 1771: 248, 1774: 249, 1787: 250, 1796: 251, 1797: 252, 1810: 253, 1815: 254, 1841: 255, 1842: 256, 1846: 257, 1851: 258, 1863: 259, 1868: 260, 1881: 261, 1886: 262, 1901: 263, 1902: 264, 1906: 265, 1912: 266, 1924: 267, 1932: 268, 1949: 269, 1954: 270, 1998: 271, 2021: 272, 2029: 273, 2030: 274, 2034: 275, 2038: 276, 2039: 277, 2048: 278, 2055: 279, 2063: 280}
class6= {7: 0, 25: 1, 46: 2, 48: 3, 76: 4, 94: 5, 100: 6, 145: 7, 154: 8, 156: 9, 214: 10, 215: 11, 223: 12, 285: 13, 295: 14, 381: 15, 409: 16, 459: 17, 465: 18, 706: 19, 846: 20, 873: 21, 912: 22, 997: 23, 1004: 24, 1013: 25, 1073: 26, 1089: 27, 1110: 28, 1118: 29, 1141: 30, 1143: 31, 1202: 32, 1233: 33, 1243: 34, 1256: 35, 1381: 36, 1383: 37, 1406: 38, 1429: 39, 1519: 40, 1527: 41, 1540: 42, 1552: 43, 1582: 44, 1593: 45, 1671: 46, 1681: 47, 1768: 48, 1823: 49, 1855: 50, 1862: 51, 1914: 52, 1939: 53, 1961: 54, 2020: 55, 2026: 56, 2031: 57, 2042: 58, 2051: 59}
class7= {2: 0, 12: 1, 13: 2, 20: 3, 22: 4, 30: 5, 40: 6, 41: 7, 43: 8, 44: 9, 45: 10, 57: 11, 74: 12, 82: 13, 84: 14, 86: 15, 101: 16, 102: 17, 125: 18, 127: 19, 151: 20, 173: 21, 184: 22, 193: 23, 199: 24, 207: 25, 208: 26, 239: 27, 241: 28, 255: 29, 261: 30, 262: 31, 267: 32, 274: 33, 308: 34, 311: 35, 313: 36, 316: 37, 326: 38, 328: 39, 330: 40, 331: 41, 342: 42, 347: 43, 349: 44, 354: 45, 355: 46, 358: 47, 383: 48, 403: 49, 426: 50, 448: 51, 455: 52, 462: 53, 473: 54, 476: 55, 481: 56, 500: 57, 517: 58, 529: 59, 531: 60, 543: 61, 549: 62, 550: 63, 562: 64, 563: 65, 571: 66, 575: 67, 582: 68, 594: 69, 600: 70, 603: 71, 607: 72, 612: 73, 632: 74, 652: 75, 655: 76, 663: 77, 681: 78, 684: 79, 688: 80, 689: 81, 692: 82, 695: 83, 703: 84, 710: 85, 731: 86, 736: 87, 745: 88, 749: 89, 761: 90, 766: 91, 771: 92, 781: 93, 790: 94, 795: 95, 800: 96, 801: 97, 802: 98, 817: 99, 823: 100, 856: 101, 907: 102, 916: 103, 918: 104, 922: 105, 933: 106, 945: 107, 955: 108, 964: 109, 966: 110, 973: 111, 996: 112, 1015: 113, 1018: 114, 1028: 115, 1032: 116, 1046: 117, 1055: 118, 1076: 119, 1079: 120, 1091: 121, 1106: 122, 1116: 123, 1124: 124, 1149: 125, 1152: 126, 1156: 127, 1166: 128, 1171: 129, 1179: 130, 1185: 131, 1199: 132, 1210: 133, 1242: 134, 1246: 135, 1248: 136, 1260: 137, 1267: 138, 1268: 139, 1270: 140, 1271: 141, 1285: 142, 1296: 143, 1298: 144, 1304: 145, 1319: 146, 1321: 147, 1322: 148, 1342: 149, 1349: 150, 1350: 151, 1353: 152, 1374: 153, 1387: 154, 1393: 155, 1394: 156, 1433: 157, 1473: 158, 1488: 159, 1510: 160, 1515: 161, 1526: 162, 1530: 163, 1534: 164, 1566: 165, 1577: 166, 1608: 167, 1633: 168, 1635: 169, 1662: 170, 1663: 171, 1666: 172, 1684: 173, 1685: 174, 1688: 175, 1709: 176, 1725: 177, 1731: 178, 1733: 179, 1737: 180, 1740: 181, 1743: 182, 1746: 183, 1747: 184, 1749: 185, 1754: 186, 1755: 187, 1756: 188, 1767: 189, 1782: 190, 1793: 191, 1794: 192, 1800: 193, 1805: 194, 1813: 195, 1821: 196, 1827: 197, 1830: 198, 1839: 199, 1848: 200, 1854: 201, 1856: 202, 1869: 203, 1877: 204, 1899: 205, 1905: 206, 1908: 207, 1909: 208, 1913: 209, 1916: 210, 1918: 211, 1926: 212, 1937: 213, 1940: 214, 1942: 215, 1943: 216, 1944: 217, 1952: 218, 1960: 219, 1962: 220, 1974: 221, 1975: 222, 1979: 223, 1987: 224, 1995: 225, 1997: 226, 2000: 227, 2003: 228, 2006: 229, 2017: 230, 2023: 231, 2028: 232, 2043: 233, 2046: 234, 2064: 235}
class8= {0: 0, 4: 1, 6: 2, 11: 3, 16: 4, 19: 5, 32: 6, 52: 7, 55: 8, 67: 9, 69: 10, 70: 11, 73: 12, 78: 13, 85: 14, 89: 15, 95: 16, 107: 17, 118: 18, 122: 19, 124: 20, 140: 21, 141: 22, 148: 23, 149: 24, 150: 25, 170: 26, 181: 27, 182: 28, 202: 29, 203: 30, 205: 31, 228: 32, 232: 33, 253: 34, 270: 35, 287: 36, 305: 37, 340: 38, 343: 39, 348: 40, 357: 41, 368: 42, 385: 43, 391: 44, 398: 45, 400: 46, 411: 47, 424: 48, 437: 49, 452: 50, 491: 51, 504: 52, 505: 53, 508: 54, 523: 55, 534: 56, 542: 57, 545: 58, 552: 59, 598: 60, 601: 61, 602: 62, 626: 63, 627: 64, 629: 65, 677: 66, 693: 67, 702: 68, 725: 69, 726: 70, 732: 71, 733: 72, 742: 73, 754: 74, 756: 75, 759: 76, 765: 77, 803: 78, 829: 79, 840: 80, 855: 81, 864: 82, 893: 83, 895: 84, 897: 85, 901: 86, 910: 87, 934: 88, 941: 89, 950: 90, 951: 91, 956: 92, 972: 93, 976: 94, 984: 95, 987: 96, 988: 97, 992: 98, 993: 99, 999: 100, 1008: 101, 1021: 102, 1026: 103, 1033: 104, 1039: 105, 1063: 106, 1065: 107, 1074: 108, 1080: 109, 1086: 110, 1087: 111, 1093: 112, 1098: 113, 1105: 114, 1123: 115, 1134: 116, 1142: 117, 1148: 118, 1172: 119, 1182: 120, 1184: 121, 1209: 122, 1214: 123, 1223: 124, 1227: 125, 1252: 126, 1255: 127, 1259: 128, 1263: 129, 1290: 130, 1300: 131, 1306: 132, 1312: 133, 1326: 134, 1328: 135, 1364: 136, 1391: 137, 1397: 138, 1403: 139, 1415: 140, 1419: 141, 1435: 142, 1437: 143, 1440: 144, 1441: 145, 1442: 146, 1449: 147, 1452: 148, 1468: 149, 1475: 150, 1502: 151, 1509: 152, 1511: 153, 1529: 154, 1537: 155, 1539: 156, 1557: 157, 1567: 158, 1584: 159, 1600: 160, 1602: 161, 1604: 162, 1617: 163, 1646: 164, 1647: 165, 1648: 166, 1665: 167, 1674: 168, 1700: 169, 1712: 170, 1721: 171, 1726: 172, 1727: 173, 1734: 174, 1741: 175, 1753: 176, 1758: 177, 1761: 178, 1775: 179, 1779: 180, 1780: 181, 1789: 182, 1790: 183, 1798: 184, 1801: 185, 1802: 186, 1803: 187, 1817: 188, 1820: 189, 1867: 190, 1894: 191, 1895: 192, 1907: 193, 1919: 194, 1936: 195, 1951: 196, 1957: 197, 1958: 198, 1966: 199, 1970: 200, 1992: 201, 2014: 202, 2018: 203, 2052: 204, 2059: 205}
class9= {60: 0, 106: 1, 166: 2, 290: 3, 298: 4, 388: 5, 438: 6, 480: 7, 587: 8, 796: 9, 832: 10, 899: 11, 1059: 12, 1128: 13, 1140: 14, 1365: 15, 1378: 16, 1428: 17, 1434: 18, 1507: 19, 1811: 20, 1874: 21, 2040: 22}

class0_reverse = {value: i for i, value in class0.items()}
class1_reverse = {value: i for i, value in class1.items()}
class2_reverse = {value: i for i, value in class2.items()}
class3_reverse = {value: i for i, value in class3.items()}
class4_reverse = {value: i for i, value in class4.items()}
class5_reverse = {value: i for i, value in class5.items()}
class6_reverse = {value: i for i, value in class6.items()}
class7_reverse = {value: i for i, value in class7.items()}
class8_reverse = {value: i for i, value in class8.items()}
class9_reverse = {value: i for i, value in class9.items()}
class GNN(torch.nn.Module):
    def __init__(self, in_channels, hidden_channels, out_channels,
                 normalize=False, lin=True):
        super().__init__()

        self.conv1 = DenseSAGEConv(in_channels, hidden_channels, normalize)
        self.bn1 = torch.nn.BatchNorm1d(hidden_channels)
        self.conv2 = DenseSAGEConv(hidden_channels, hidden_channels, normalize)
        self.bn2 = torch.nn.BatchNorm1d(hidden_channels)
        self.conv3 = DenseSAGEConv(hidden_channels, out_channels, normalize)
        self.bn3 = torch.nn.BatchNorm1d(out_channels)

        if lin is True:
            self.lin = torch.nn.Linear(2 * hidden_channels + out_channels,
                                       out_channels)
        else:
            self.lin = None

    def bn(self, i, x):
        batch_size, num_nodes, num_channels = x.size()

        x = x.view(-1, num_channels)
        x = getattr(self, f'bn{i}')(x)
        x = x.view(batch_size, num_nodes, num_channels)
        return x

    def forward(self, x, adj, mask=None):
        batch_size, num_nodes, in_channels = x.size()

        x0 = x
        x1 = self.bn(1, F.relu(self.conv1(x0, adj, mask)))
        x2 = self.bn(2, F.relu(self.conv2(x1, adj, mask)))
        x3 = self.bn(3, F.relu(self.conv3(x2, adj, mask)))

        x = torch.cat([x1, x2, x3], dim=-1)

        if self.lin is not None:
            x = F.relu(self.lin(x))

        return x


class Net(torch.nn.Module):
    def __init__(self):
        super().__init__()

        num_nodes = ceil(0.25 * max_nodes)
        self.gnn1_pool = GNN(dataset.num_features, 64, num_nodes)
        self.gnn1_embed = GNN(dataset.num_features, 64, 64, lin=False)

        num_nodes = ceil(0.25 * num_nodes)
        self.gnn2_pool = GNN(3 * 64, 64, num_nodes)
        self.gnn2_embed = GNN(3 * 64, 64, 64, lin=False)

        self.gnn3_embed = GNN(3 * 64, 64, 64, lin=False)

        self.lin1 = torch.nn.Linear(3 * 64, 64)
        self.lin2 = torch.nn.Linear(64, dataset.num_classes)

    def forward(self, x, adj, mask=None):
        s = self.gnn1_pool(x, adj, mask)
        x = self.gnn1_embed(x, adj, mask)

        x, adj, l1, e1 = dense_diff_pool(x, adj, s, mask)

        s = self.gnn2_pool(x, adj)
        x = self.gnn2_embed(x, adj)

        x, adj, l2, e2 = dense_diff_pool(x, adj, s)

        x = self.gnn3_embed(x, adj)

        x = x.mean(dim=1)
        x = F.relu(self.lin1(x))
        x = self.lin2(x)
        return F.log_softmax(x, dim=-1), l1 + l2, e1 + e2


device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')
model = Net().to(device)
optimizer = torch.optim.Adam(model.parameters(), lr=0.001)


def train(epoch):
    model.train()
    loss_all = 0

    for data in train_loader:
        data = data.to(device)
        optimizer.zero_grad()
        output, _, _ = model(data.x, data.adj, data.mask)
        loss = F.nll_loss(output, data.y.view(-1))
        loss.backward()
        loss_all += data.y.size(0) * loss.item()
        optimizer.step()
    return loss_all / len(train_dataset)


# @torch.no_grad()
# def test(loader):
#     model.eval()
#     correct = 0
#
#     for data in loader:
#         data = data.to(device)
#         pred = model(data.x, data.adj, data.mask)[0].max(dim=1)[1]
#         correct += pred.eq(data.y.view(-1)).sum().item()
#     return correct / len(loader.dataset)
@torch.no_grad()                 #加上GCN distance
def test(loader):
    model.eval()
    correct = 0
    labels = []
    preds = []
    for data in loader:
        data = data.to(device)
        pred = model(data.x, data.adj, data.mask)[0].max(dim=1)[1]
        correct += pred.eq(data.y.view(-1)).sum().item()

        labels.append(np.squeeze(data['y'].data.numpy()))
        preds.append(pred.cpu().data.numpy())

    labels = np.hstack(labels)
    preds = np.hstack(preds)
    # print("labels:", labels)
    # print("preds:", preds)
    real_labels = []
    for n in labels:
        real_labels.append(class8_reverse[n])
    real_preds = []
    for m in preds:
        real_preds.append(class8_reverse[m])
    # print('reallabels:', real_labels)
    # print('realpreds:', real_preds)
    read_dic = np.load(bmname+"_short_path.npy", allow_pickle=True).item()
    # print(read_dic[2][3])
    distance = []
    for i in range(len(labels)):
        a = read_dic[real_labels[i]][real_preds[i]]
        distance.append(a)
    #print(distance)
    result_dis = {}
    sum_dis = 0
    for i in set(distance):
        result_dis[i] = distance.count(i)
        sum_dis = i * result_dis[i] + sum_dis
    average_dis = sum_dis / len(labels)

    return correct / len(loader.dataset), average_dis

best_val_acc = test_acc = 0
for epoch in range(1, 50):
    train_loss = train(epoch)
    val_acc, val_GCN = test(val_loader)
    if val_acc > best_val_acc:
        test_acc, test_GCN = test(test_loader)
        best_val_acc = val_acc
    print(f'Epoch: {epoch:03d}, Train Loss: {train_loss:.4f}, '
          f'Val Acc: {val_acc:.4f}, Test Acc: {test_acc:.4f}, '
          f'Val_GCN: {val_GCN:.4f}, Test_GCN: {test_GCN:.4f}')
    if epoch % 10 == 0:
        torch.save(model.state_dict(), 'model/' + bmname + sname + '_diff_pool.pt')
#保存模型
torch.save(model.state_dict(), 'model/' + bmname + sname + '_diff_pool.pt')